---
title: "Fortnite Ping FNCS Heat Seeds"
output:
  html_document: 
    includes:
      in_header: analytics.html
  pdf_document: default
  word_document: default
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=10, fig.height=6, fig.path='Figs/',
                      echo=FALSE, warning=FALSE, message=FALSE)

# Show a maximum of 100   
options(tibble.print_max = 100, tibble.print_min = 15)

library(tidyverse)
library(utf8)
library(DT)
library(DBI)

con <- DBI::dbConnect(odbc::odbc(), 
                      Driver = "SQL Server", 
                      Server = "DESKTOP-S1K43CL\\SQLEXPRESS", 
                      Database = "Fortnite", 
                      Trusted_Connection = "True")


#squads <- dbGetQuery(con, paste0("SELECT * FROM SquadDisplayView ORDER BY Region, [FNCS Rank]")) 
squads <- dbGetQuery(con, paste0("SELECT * FROM SquadDisplayView ORDER BY Region, Heat, Seed")) 

loc = locale(date_names = "en", date_format = "%AD", time_format = "%AT",
  decimal_mark = ".", grouping_mark = ",", tz = "UTC",
  encoding = "UTF-8", asciify = FALSE)

path = "C:/project/fortnite/r/champion-series-squads/data/"

```
Back to [Fortnite Ping](<https://www.fortniteping.com>) 

# {.tabset .tabset-fade}


```{r definition, echo = FALSE}

region_tables <- function(region, heat) {

  table <- filter(squads, Region == region & Heat == heat) %>%
    select(-Region) %>%
    select(-Heat)  
  
  #heat <- filter(region, Heat == heat_num)
  
  breaks <- c(25, 50, 100, 200)
  colors <- c(
    rgb(38, 110, 246, maxColorValue = 255), 
    rgb(71, 201, 255, maxColorValue = 255), 
    rgb(130, 233, 255, maxColorValue = 255), 
    rgb(184, 242, 255, maxColorValue = 255), 
    rgb(255, 255, 255, maxColorValue = 255)
  )
  
  datatable(table, 
    class = 'cell-border nowrap stripe compact',
    options = list(paging = FALSE)) %>% 
    formatStyle('P1', background = styleInterval(breaks, colors)) %>%  
    formatStyle('P2', background = styleInterval(breaks, colors)) %>% 
    formatStyle('P3', background = styleInterval(breaks, colors)) %>%  
    formatStyle('P4', background = styleInterval(breaks, colors)) %>%
    #formatStyle('Seed', background = styleInterval(breaks, colors)) %>%
    #formatStyle('Power Rank', background = styleInterval(breaks, colors)) %>%
    formatStyle('Chemistry', fontWeight = styleInterval( c(-5, 5), c('bold', 'normal', 'bold')))
}

region_table_csv <- function(csv) {
  region <- read_csv(str_c(path, csv))
  datatable(region, 
    class = 'cell-border nowrap stripe compact',
    options = list(paging = FALSE)
  )
}

heat_table <- function(region, heat_num) {
  
  heat <- filter(region, Heat == heat_num)
  
  breaks <- c(25, 50, 100, 200)
  colors <- c(
    rgb(38, 110, 246, maxColorValue = 255), 
    rgb(71, 201, 255, maxColorValue = 255), 
    rgb(130, 233, 255, maxColorValue = 255), 
    rgb(184, 242, 255, maxColorValue = 255), 
    rgb(255, 255, 255, maxColorValue = 255)
  )
  
  datatable(heat, 
    class = 'cell-border nowrap stripe compact',
    options = list(paging = FALSE)) %>% 
    formatStyle('P1', background = styleInterval(breaks, colors)) %>%  
    formatStyle('P2', background = styleInterval(breaks, colors)) %>% 
    formatStyle('P3', background = styleInterval(breaks, colors)) %>%  
    formatStyle('P4', background = styleInterval(breaks, colors)) %>%
    formatStyle('Seed', background = styleInterval(breaks, colors)) %>%
    #formatStyle('Power Rank', background = styleInterval(breaks, colors)) %>%
    formatStyle('Chemistry', fontWeight = styleInterval( c(-5, 5), c('bold', 'normal', 'bold')))
}
  
```

## Europe

### Europe Heat 1
```{r europe_heat1} 
region_tables("Europe", 1) 
```

### Europe Heat 2
```{r europe_heat2} 
region_tables("Europe", 2) 
```

### Europe Heat 3
```{r europe_heat3} 
region_tables("Europe", 3) 
```

### Europe Heat 4
```{r europe_heat4} 
region_tables("Europe", 4) 
```

## NA East

### NA East Heat 1
```{r na_east_heat1} 
region_tables("NA East", 1) 
```

### NA East Heat 2
```{r na_east_heat2} 
region_tables("NA East", 2) 
```

### NA East Heat 3
```{r na_east_heat3} 
region_tables("NA East", 3) 
```

### NA East Heat 4
```{r na_east_heat4} 
region_tables("NA East", 4) 
```

## NA West

### NA West Heat 1
```{r na_west_heat1} 
region_tables("NA West", 1) 
```

### NA West Heat 2

```{r na_west_heat2} 
region_tables("NA West", 2) 
```

### NA West Heat 3
```{r na_west_heat3} 
region_tables("NA West", 3) 
```

### NA West Heat 4
```{r na_west_heat4} 
region_tables("NA West", 4) 

## Brazil

### Brazil Heat 1
```{r brazil_heat1} 
region_tables("Brazil", 1) 
```

### Brazil Heat 2
```{r brazil_heat2} 
region_tables("NA West", 2) 
```

### Brazil Heat 3
```{r brazil_heat3} 
region_tables("NA West", 3) 
```

### Brazil  Heat 4
```{r brazil_heat4} 
region_tables("Brazil ", 4) 

```


## Asia

### Asia Heat 1
```{r asia_heat1} 
region_tables("Asia", 1) 
```

### Asia Heat 2
```{r asia_heat2} 
region_tables("Asia", 2) 
```

## Oceania

### Oceania Heat 1
```{r oceania_heat1} 
region_tables("Oceania", 1) 
```

### Oceania Heat 2
```{r oceania_heat2} 
region_tables("Oceania", 2) 
```

## Middle East

### Middle East Heat 1
```{r middle_east_heat1} 
region_tables("Middle East", 1) 
```

### Middle East Heat 2
```{r middle_east_heat2} 
region_tables("Middle East", 2) 
```


## Column Key

##### Blue cells mean higher player Power Rankings   

* Column Key
  + Seed: Ranking of squad based on average placement in qualifiers (the "FNCS Placements" column.)  
  + Player 1 - 4: players and their Power Ranking points. Player #1 has the most points on each squad; #4 has the least
  + Squad Placements: placements for FNCS weeks 1-4, and their average. Weekly placements are capped at a maximum of 500.
  + Avg Points: Average power ranking of squad, in thousands.
  + Power Rank: Rank of squads in the heat based on the "Avg Points" column.
  + Chemistry: Difference between "Power Rank" and "Seed" cloumns. Negative scores mean a squad is performing less well than the sum of the team's Power Rankings would lead you to expect. A positive number means the squad is performing better, suggesting the team members play well together, or that the team has up-and-coming players.  
